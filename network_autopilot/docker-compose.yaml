services:
  # --------------------------------
  # Continuous Operation (Main Loop)
  # --------------------------------
  autopilot:
    build:
      context: .
      args:
        POETRY_ENV: prod
    env_file: .env
    container_name: network_autopilot
    environment:
      - TZ=${TZ:-UTC}
    restart: unless-stopped

  # --------------------------------
  # On-Demand Execution (Manual Run)
  # --------------------------------
  manual_run:
    build:
      context: .
      args:
        POETRY_ENV: prod
    env_file: .env
    container_name: network_autopilot_manual
    environment:
      - TZ=${TZ:-UTC}
    restart: "no"







# services:
#   app:
#     build: .
#     container_name: network_autopilot_app
#     env_file: .env
#     environment:
#       - PYTHONPATH=/app/src
#       - TZ=${TZ:-UTC}
#     command: python -m network_autopilot.__main__
#     restart: unless-stopped






# services:
#   # -------------------------------------------------------------------
#   # Manual Testing Mode
#   # -------------------------------------------------------------------
#   app:
#     build: .
#     env_file: .env
#     container_name: network_autopilot_app
#     command: python -m network_autopilot.__main__
#     environment:
#       - PYTHONPATH=/app/src
#       - TZ=${TZ:-UTC}
#     volumes:
#       # Mount the current directory into the container at /app
#       - .:/app
#       # Mount the host API keys path (from .env) and mirror the local path inside the container
#       - ${GOOGLE_API_KEY_LOCAL}:${GOOGLE_API_KEY_DOCKER}:ro   # Dynamically mount based on .env
#     restart: unless-stopped   # Auto-restarts on reboot/failure unless manually stopped

#   # -------------------------------------------------------------------
#   # Scheduled Execution Mode
#   # -------------------------------------------------------------------
#   cron:
#     build: .
#     env_file: .env
#     container_name: network_autopilot_cron
#     command: >
#       sh -c "while true; do
#                python -m network_autopilot.__main__;
#                sleep 60;
#              done"
#     environment:
#       - PYTHONPATH=/app/src
#       - TZ=${TZ:-UTC}
#     volumes:
#       - .:/app
#       - ${GOOGLE_API_KEY_LOCAL}:${GOOGLE_API_KEY_DOCKER}:ro
#     restart: unless-stopped   # Auto-restarts on reboot/failure unless manually stopped
